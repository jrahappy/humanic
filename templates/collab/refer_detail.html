{% extends 'collab/base.html' %}
{% load static %}
{% load custom_filters %}
{% load widget_tweaks %}

{% block header %}
    {% include 'collab/header.html' %}
{% endblock %}

{% block content %}
<section class="card col-span-12 overflow-hidden bg-base-100 shadow-sm xl:col-span-12">
    <div class="card-body grow-0">
        <div class="flex justify-between gap-2 w-full">
            <div class="flex flex-row justify-between w-2/3">
                <h2 class="card-title ">
                    검사의뢰서 보기 / {{ refer.id }} / {{ company.id }}
                </h2>
                <div class="flex flex-col">
                    <form method="get" action="{% url 'customer:index' %}">
                        <label class="input input-bordered flex items-center gap-2">
                            <input type="text" class="grow" placeholder="Search" name="q" />
                            <svg
                              xmlns="http://www.w3.org/2000/svg"
                              viewBox="0 0 16 16"
                              fill="currentColor"
                              class="h-4 w-4 opacity-70">
                              <path
                                fill-rule="evenodd"
                                d="M9.965 11.026a5 5 0 1 1 1.06-1.06l2.755 2.754a.75.75 0 1 1-1.06 1.06l-2.755-2.754ZM10.5 7a3.5 3.5 0 1 1-7 0 3.5 3.5 0 0 1 7 0Z"
                                clip-rule="evenodd" />
                            </svg>
                          </label>
                    </form>
                </div>
            </div>
            <div class="text-end me-4 w-1/3">
                <a href="{% url 'collab:index' %}" class="btn btn-primary btn-sm text-white ">돌아가기</a>
            </div>
            
        </div>
    </div>
</section>
<section class="card col-span-12 overflow-hidden bg-base-100 shadow-sm xl:col-span-6">
    <div class="card-body grow-0">
        <div id="refer_create_box" class="">
            <div id="print_area" class="w-full">
                <table  class="table min-w-full divide-y devide-x divide-gray-900">
                    <tr class="align-top border border-gray-500">
                        <td colspan="4" class="w-24 text-bold text-2xl text-center">검  사  의  뢰  서</td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td class="w-24 align-top border-e border-gray-500">의뢰병원</td>
                        <td class="w-48 align-top border-e border-gray-500">{{company.business_name}} </td>
                        <td class="w-24 align-top border-e border-gray-500">의사명</td>
                        <td class="w-48">{{company.president_name}} </td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td class="align-top border-e border-gray-500">의뢰일</td>
                        <td class="align-top border-e border-gray-500">{{ refer.referred_date }}</td>
                        <td class="align-top border-e border-gray-500">상태</td>
                        <td>{{ refer.status }}</td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td class="align-top border-e border-gray-500">환자명</td>
                        <td class="align-top border-e border-gray-500">{{ refer.patient_name }}</td>
                        <td class="align-top border-e border-gray-500">환자성별</td>
                        <td>{{ refer.patient_gender }}</td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td class="align-top border-e border-gray-500">생년월일</td>
                        <td class="align-top border-e border-gray-500">{{ refer.patient_birthdate }}</td>
                        <td class="align-top border-e border-gray-500">연락처</td>
                        <td>{{ refer.patient_phone }}</td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td class="align-top border-e border-gray-500">환자상병</td>
                        <td class="align-top border-e border-gray-500">
                            {% for ill in illnesses %}
                                <div class="">{{ill.illness}}</div>
                            {% endfor %}
                        </td>
                        <td class="align-top border-e border-gray-500">외뢰할 검사</td>
                        <td>
                            {% for sim in simples %}
                                <div class="">{{sim.diagnosis}}</div>
                            {% endfor %}

                        </td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td colspan="1" class="align-top border-e border-gray-500">
                            <div class="font-semibold text-sm">임상소견:</div>
                        </td>
                        <td colspan="3" class="align-top border border-gray-500">
                            <div class="h-32 max-h-48 bg-base-50">{{ refer.opinion1 }}</div>
                        </td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td colspan="4" class="align-top border-e border-gray-500">
                            <div class="font-semibold text-sm text-center">오시는 길</div>
                        </td>
                    </tr>
                    <tr class="align-top border border-gray-500">
                        <td colspan="2">
                            <img src="{% static 'img/map_small.png' %}" alt="map" style="width:300px;" />
                        </td>
                        <td colspan="2" class="align-top border-e border-gray-500">
                            <div class="flex flex-col gap-2">
                                <div>
                                    전화: 1588-7515, 02-512-6695<br>
                                    팩스: 02-3014-3696 <br>
                                </div>
                                <div>
                                    주소: 서울특별시 서초구 강남대로 621 K-타워 3층 <br>
                                    주차장진입로 : K타워 1층<br>
                                    홈페이지: www.humiic.co.kr<br>
                                </div>
                                <div>
                                    진료시간<br>
                                    평일. 오전 9:00 ~ 오후 6:00 <br>
                                    토요일. 오전 9:00 ~ 오후 1:00 <br>
                                    공휴일/일요일. 휴진<br>
                                </div>
                            </div>
                        </td>
                    </tr>
                    
                </table>
                <div id="printSection" style="display:none"></div>
                <div class="flex justify-end gap-2 mt-4">
                    <a href="{% url 'collab:refer_update' refer.id %}" class="btn btn-primary btn-sm">수정하기</a>
                    <a href="{% url 'collab:refer_print' refer.id %}" class="btn btn-neutral btn-sm" onclick="openPopup(this.href); return false;">인쇄하기</a>

                    <script>
                        function openPopup(url) {
                            // Define the window features
                            var windowFeatures = 'width=800,height=600,scrollbars=yes,resizable=yes';
                        
                            // Open the new window with the specified URL and features
                            window.open(url, '_blank', windowFeatures);
                        }
                    </script>
                </div>
                
            </div>  
        </div>
    </div>
</section>
   
{% endblock %}

{% block aside %}

	{% include 'collab/aside.html' %}
	
{% endblock %}



